<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>1. cli &amp; 启动 | hudk&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="hudk&#39;s blog">
    
    <link rel="preload" href="/blog/assets/css/0.styles.b6bfb1ac.css" as="style"><link rel="preload" href="/blog/assets/js/app.54ae07b9.js" as="script"><link rel="preload" href="/blog/assets/js/2.3df5cace.js" as="script"><link rel="preload" href="/blog/assets/js/3.d10e2b65.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.957114ff.js"><link rel="prefetch" href="/blog/assets/js/11.8047ff5e.js"><link rel="prefetch" href="/blog/assets/js/12.0c41fe3a.js"><link rel="prefetch" href="/blog/assets/js/13.14d8660a.js"><link rel="prefetch" href="/blog/assets/js/14.fec54616.js"><link rel="prefetch" href="/blog/assets/js/15.7ddd8f90.js"><link rel="prefetch" href="/blog/assets/js/16.28a051ff.js"><link rel="prefetch" href="/blog/assets/js/17.3ea654d9.js"><link rel="prefetch" href="/blog/assets/js/18.5cfd97e2.js"><link rel="prefetch" href="/blog/assets/js/19.6b5ebb24.js"><link rel="prefetch" href="/blog/assets/js/20.7dafad4f.js"><link rel="prefetch" href="/blog/assets/js/4.ce719874.js"><link rel="prefetch" href="/blog/assets/js/5.7ca53369.js"><link rel="prefetch" href="/blog/assets/js/6.d40a3450.js"><link rel="prefetch" href="/blog/assets/js/7.359fdab5.js"><link rel="prefetch" href="/blog/assets/js/8.da8a10fa.js"><link rel="prefetch" href="/blog/assets/js/9.7d29730b.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.b6bfb1ac.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">hudk's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>框架</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>后端</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading open"><span>adonisjs</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-3"><a href="/blog/framework/backend/adonis/cli/index" class="sidebar-heading clickable open"><span>1. cli &amp; ignitor</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/framework/backend/adonis/cli/manifest.html" class="sidebar-link">1.1 manifest</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-3"><a href="/blog/framework/backend/adonis/application/index" class="sidebar-heading clickable"><span>2. application</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-3"><a href="/blog/framework/backend/adonis/server/index" class="sidebar-heading clickable"><span>3. http server</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li></ul></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_1-cli-启动"><a href="#_1-cli-启动" class="header-anchor">#</a> 1. cli &amp; 启动</h1> <h2 id="入口"><a href="#入口" class="header-anchor">#</a> 入口</h2> <p>基本上，看一个项目的入口，一定是看其package.json</p> <p>我们看一下hello-world的package.json</p> <p><img src="/blog/assets/img/package-json.aa6460c0.png" alt="package.json"></p> <p>可以看到，框架的入口有两个：</p> <ol><li>调试，采用dev，框架提供了一个ace的文件来实现其cli能力</li> <li>正式，采用start，使用ts编译后的版本
我们从dev开始看起</li></ol> <h2 id="ace"><a href="#ace" class="header-anchor">#</a> ace</h2> <p>hello-world/ace</p> <p><img src="/blog/assets/img/ace.c9c317b1.png" alt="ace"></p> <p>看一下结构，很简单，实际上将ace之后的内容作为参数，传入到Ignitor中</p> <h3 id="ignitor"><a href="#ignitor" class="header-anchor">#</a> Ignitor</h3> <p>core/standalone.ts</p> <p>core/src/Ignitor/index.ts</p> <p><img src="/blog/assets/img/ignitor.ca4c7e5c.png" alt="ignitor"></p> <p>顾名思义，是个点火器，其中核心的是ace方法和httpServer方法，其中后者针对的是npm start的链路，这里不展开</p> <p>可以看到，这里作为工厂函数创建了一个Ace的实例</p> <h3 id="ace-2"><a href="#ace-2" class="header-anchor">#</a> Ace</h3> <p>core/src/Ignitor/Ace/index.ts</p> <p><img src="/blog/assets/img/ace-index.55f8a8f8.png" alt="ace-core"></p> <p>Ace的外层会根据传入的命令做一个预处理，如果是为了生成manifest文件，就走红框的链路，否则走正常执行链路</p> <p>从代码上看，红框内的部分是的后添加的内容，原因放在manifest节进行说明，这里不再展开</p> <p>我们先看正常链路的执行过程</p> <h3 id="app-core中真正调用kernel的地方"><a href="#app-core中真正调用kernel的地方" class="header-anchor">#</a> App(core中真正调用kernel的地方)</h3> <p>core/src/Ignitor/Ace/App/index.ts</p> <p>App层是ace真正的application（应用管理层），内核的管理和命令的执行在这里进行</p> <p>其中，用于处理命令的hanlde大概分两步：</p> <h4 id="加载manifest"><a href="#加载manifest" class="header-anchor">#</a> 加载manifest</h4> <p><img src="/blog/assets/img/manifest.d94b677d.png" alt="manifest"></p> <p>加载部分，比较简单，其中addKernelHooks有比较重要的额外作用，算是对用户编写的插件提供了一些语法糖和附加功能</p> <p>其中ts的部分比较好理解，实际上就是支持用户通过ts编写的command</p> <p>注入ioc的部分和command的支持相关，在manifest节内详细介绍</p> <p><img src="/blog/assets/img/manifest2.98ee36c5.png" alt="manifest2"></p> <h4 id="查找并执行命令"><a href="#查找并执行命令" class="header-anchor">#</a> 查找并执行命令</h4> <p><img src="/blog/assets/img/kernel-handle.137ef78f.png" alt="kernel-handle"></p> <p>可以看到，这里调用了kernel的实例来处理command</p> <h3 id="kernel"><a href="#kernel" class="header-anchor">#</a> Kernel</h3> <p>ace/src/Kernel/index.ts</p> <p>Kernel实际上就是命令行的处理类实例，内部管理了一条命令（比如，node ace xxxxx就是一条命令）的完整执行流程及生命周期</p> <p>Kernel提供了一系列类似flag，getSuggestions的方法用于辅助，此处我们只从最核心的handle方法跟踪进入看起</p> <h4 id="handle"><a href="#handle" class="header-anchor">#</a> handle</h4> <p><img src="/blog/assets/img/kernel-handle1.ee2744d1.png" alt="kernel-handle1"></p> <p>handle分为三个分支，前两个分支处理了 没有参数情况下的基础命令 和 带flag（比如说help）的命令情况，比较简单</p> <p><img src="data:image/png;base64,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" alt="kernel-handle2"></p> <p>我们主要看branch 3，用来处理带参数情况的命令</p> <p>从逻辑上来说，这里是我们正式执行命令的最终逻辑分支，这里也是被抽成了一个独立函数</p> <h4 id="execmain"><a href="#execmain" class="header-anchor">#</a> execMain</h4> <p><img src="/blog/assets/img/exec-main.022aebc9.png" alt="exec-main"></p> <p>逻辑也比较清晰，查找 → 实例化 → （前置+钩子） →  执行</p> <p>查找：find方法</p> <p>实例化：makeAsync，是通过ioc提供的方法，根据command（类名称）来实例化了一个真正的command类；实际上，这里因为没有注入过，所以每个command都是同步生成的（所以用的是async方法）</p> <p>执行：执行了command的exec方法，内部实际上也是通过ioc来做的，这里也不再展开了</p> <h4 id="serve-command"><a href="#serve-command" class="header-anchor">#</a> Serve Command</h4> <p>以node ace serve为例，commandName为serve，其寻址实际是通过assembler下的ace-manifest.json来寻址的，寻址这块在manifest中详细介绍</p> <p><img src="/blog/assets/img/serve-command.b2824e0c.png" alt="serve-command"></p> <p>可以看到，最终定位到的位置是assembler\commands\Serve.ts</p> <p><img src="/blog/assets/img/serve-command2.f67a330b.png" alt="serve-command2"></p> <p>逻辑很简单，动态引入并执行了devserver，跟进去看一眼</p> <p><img src="/blog/assets/img/serve-command3.0480c494.png" alt="serve-command3"></p> <p>可以看到，最终实际上是通过子进程的方式，启动了hello-world下的server.ts</p> <p>回到文章开头，我们可以发现，他和我们的另一条链路：正式服务启动（npm start）联系上了，只是两者一个是通过子进程启动，并且做了热更新和监控的能力，另一个是直接启动编译后的文件，用于生产环境</p> <p>我们再来看下server.ts这条链路究竟做了什么</p> <h2 id="serve"><a href="#serve" class="header-anchor">#</a> Serve</h2> <p>hello-world/server.ts</p> <p><img src="/blog/assets/img/serve.548a0529.png" alt="serve"></p> <p>可以看到，此时走的是点火器的httpServer部分</p> <h3 id="ignitor-httpserver"><a href="#ignitor-httpserver" class="header-anchor">#</a> Ignitor.httpServer</h3> <p><img src="/blog/assets/img/serve2.14a862b9.png" alt="serve2"></p> <p>内容很简单，启动了application和server，并且注册了相应的listener处理错误</p> <p>其中，application是服务的运行时管理，server提供了http服务的能力，通过这种方式，一个完整的运行时服务就启动了</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.54ae07b9.js" defer></script><script src="/blog/assets/js/2.3df5cace.js" defer></script><script src="/blog/assets/js/3.d10e2b65.js" defer></script>
  </body>
</html>
